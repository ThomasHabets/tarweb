syntax = "proto3";

package tarweb;

message Rule {
        string regex = 1;
        Backend backend = 2;
}

message Backend {
        message Tls {
                string cert_file = 1;
                string key_file = 2;
        }
        message Null {
        }
        message Proxy {
                string addr = 1;
                Tls tls = 2;
        }
        message Pass {
                string path = 1;
                Tls tls = 2;
        }
        oneof backend {
                Null null = 1;
                Proxy proxy = 2;
                Pass pass = 3;
        }

        // Max connection lifetime.
        //
        // For Proxy backends this is more real than for Pass backends.
        //
        // For Pass backends it's basically just the `ClientHello` snoop time,
        // unless it's also the TLS handshake time. There's no timing out after
        // the FD has been handed off.
        uint64 max_lifetime_ms = 4;
}

message SNIConfig {
        repeated Rule rules = 1;
        Backend default_backend = 2;

        // See commend on field in Backend message.
        uint64 max_lifetime_ms = 3;
}
